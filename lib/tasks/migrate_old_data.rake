task :migrate_old_data => :environment do
  desc 'Migrate old data from ethnicchic'

  MigrateOldDbToEthnicchick2.new.exec_migration(ActiveRecord::Base.connection, :up)

  VariantPricesMigration.new.migrate_with_log
  BrandsMigration.new.migrate_with_log
  BackgroundsMigration.new.migrate_with_log
  CalculatorPreferencesMigration.new.migrate_with_log
  SpreeZonesForPopupMigration.new.migrate_with_log

  #recreate right schema_migrations from dump
  ActiveRecord::Base.connection.execute("
DELETE FROM schema_migrations;
INSERT INTO schema_migrations (version) VALUES
('20150209100825'),
('20150209100826'),
('20150209100827'),
('20150209100828'),
('20150209100829'),
('20150209100830'),
('20150209100831'),
('20150209100832'),
('20150209100833'),
('20150209100834'),
('20150209100835'),
('20150209100836'),
('20150209100837'),
('20150209100838'),
('20150209100839'),
('20150209100840'),
('20150209100841'),
('20150209100842'),
('20150209100843'),
('20150209100844'),
('20150209100845'),
('20150209100846'),
('20150209100847'),
('20150209100848'),
('20150209100849'),
('20150209100850'),
('20150209100851'),
('20150209100852'),
('20150209100853'),
('20150209100854'),
('20150209100855'),
('20150209100856'),
('20150209100857'),
('20150209100858'),
('20150209100859'),
('20150209100860'),
('20150209100861'),
('20150209100862'),
('20150209100863'),
('20150209100864'),
('20150209100865'),
('20150209100866'),
('20150209100867'),
('20150209100868'),
('20150209100869'),
('20150209100870'),
('20150209100871'),
('20150209100872'),
('20150209100873'),
('20150209100874'),
('20150209100875'),
('20150209100876'),
('20150209100877'),
('20150209100878'),
('20150209100879'),
('20150209100880'),
('20150209100881'),
('20150209100882'),
('20150209100883'),
('20150209100884'),
('20150209100885'),
('20150209100886'),
('20150209100887'),
('20150209100888'),
('20150209100889'),
('20150209100890'),
('20150209100891'),
('20150209100892'),
('20150209100893'),
('20150209100894'),
('20150209100895'),
('20150209100896'),
('20150209100897'),
('20150209100898'),
('20150209100899'),
('20150209100900'),
('20150209100901'),
('20150209100902'),
('20150209100903'),
('20150209100904'),
('20150209100905'),
('20150209100906'),
('20150209100907'),
('20150209100908'),
('20150209100909'),
('20150209100910'),
('20150209100911'),
('20150209100912'),
('20150209100913'),
('20150209100914'),
('20150209100915'),
('20150209100916'),
('20150209100917'),
('20150209100918'),
('20150209100919'),
('20150209100920'),
('20150209100921'),
('20150209100922'),
('20150209100923'),
('20150209100924'),
('20150209100925'),
('20150209100926'),
('20150209100927'),
('20150209100928'),
('20150209100929'),
('20150209100930'),
('20150209100931'),
('20150209100932'),
('20150209100933'),
('20150209100934'),
('20150209100935'),
('20150209100936'),
('20150209100937'),
('20150209100938'),
('20150209100939'),
('20150209100940'),
('20150209100941'),
('20150209100942'),
('20150209100943'),
('20150209100944'),
('20150209100945'),
('20150209100946'),
('20150209100947'),
('20150209100948'),
('20150209100949'),
('20150209100950'),
('20150209100951'),
('20150209100952'),
('20150209100953'),
('20150209100954'),
('20150209100955'),
('20150209100956'),
('20150209100957'),
('20150209100958'),
('20150209100959'),
('20150209100960'),
('20150209100961'),
('20150209100962'),
('20150209100963'),
('20150209100964'),
('20150209100965'),
('20150209100966'),
('20150209100967'),
('20150209100968'),
('20150209100969'),
('20150209100970'),
('20150209100971'),
('20150209100972'),
('20150209100973'),
('20150209100974'),
('20150209100975'),
('20150209100976'),
('20150209100977'),
('20150209100978'),
('20150209100979'),
('20150209100980'),
('20150209100981'),
('20150209100982'),
('20150209100983'),
('20150209100984'),
('20150209100985'),
('20150209100986'),
('20150209100987'),
('20150209100988'),
('20150209100989'),
('20150209100990'),
('20150209100991'),
('20150209100992'),
('20150209100993'),
('20150209100994'),
('20150209100995'),
('20150209100996'),
('20150209100997'),
('20150209100998'),
('20150209100999'),
('20150209101000'),
('20150209101001'),
('20150209101002'),
('20150209101003'),
('20150209101004'),
('20150209101005'),
('20150209101006'),
('20150209101007'),
('20150209101008'),
('20150209101009'),
('20150209101010'),
('20150209101011'),
('20150209101012'),
('20150209101013'),
('20150209101014'),
('20150209101015'),
('20150209101016'),
('20150209101017'),
('20150209101018'),
('20150209101019'),
('20150209101020'),
('20150209101021'),
('20150209101022'),
('20150209101023'),
('20150209101024'),
('20150209101025'),
('20150209101026'),
('20150209101027'),
('20150209101028'),
('20150209101029'),
('20150209101030'),
('20150209101031'),
('20150209101032'),
('20150209101033'),
('20150209101034'),
('20150209101035'),
('20150211111433'),
('20150211111434'),
('20150211111435'),
('20150211111436'),
('20150211111437'),
('20150211111438'),
('20150211111439'),
('20150211111440'),
('20150211111441'),
('20150211111442'),
('20150211111443'),
('20150212071100'),
('20150217080744'),
('20150217080745'),
('20150218073701'),
('20150218085544'),
('20150219082712'),
('20150223140009'),
('20150223140010'),
('20150224064336'),
('20150224070439'),
('20150225080000'),
('20150225080001'),
('20150225080002'),
('20150225080003'),
('20150225080004'),
('20150225080005'),
('20150225080006'),
('20150225080007'),
('20150225080008'),
('20150225080009'),
('20150225080010'),
('20150225080011'),
('20150225080012');"
)

  puts 'Schema migrations recreated!'

  # renew schema
  Rake::Task["db:schema:dump"].execute
  puts "Schema dumped!"

  Spree::Store.create(name: 'Ethnicchic',
                      url: 'http://ethnicchic.com/',
                      meta_description: 'Ethnicchic',
                      meta_keywords: 'Ethnicchic',
                      seo_title: 'Ethnicchic',
                      mail_from_address: 'info@ethnicchic.com',
                      default_currency: 'EUR',
                      code: 'ethnicchic',
                      default: true )

  Spree::Page.all.each do |page|
    page.stores << Spree::Store.last
    page.save!
  end

end
